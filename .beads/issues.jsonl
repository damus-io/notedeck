{"id":"notedeck-34h","title":"Fix expect() on notification_manager (jb55 important #7)","description":"From jb55 review:\n- Settings UI calls expect() on notification_manager\n- Should use graceful fallback with if let Some(...)\n- Location: crates/notedeck_columns/src/ui/settings.rs","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-26T14:46:54.434069-06:00","created_by":"e","updated_at":"2026-01-26T15:13:02.482017-06:00","closed_at":"2026-01-26T15:13:02.482017-06:00","close_reason":"Not found - code uses unwrap_or(false) and if let Err(e), not expect()"}
{"id":"notedeck-34p","title":"Address 14 unaddressed CodeRabbit comments","description":"Files with unaddressed CodeRabbit comments:\n- crates/notedeck/src/notifications/bolt11.rs\n- crates/notedeck/src/notifications/extraction.rs\n- crates/notedeck/src/notifications/image_cache.rs\n- crates/notedeck/src/notifications/macos.rs\n- crates/notedeck/src/notifications/profiles.rs\n- crates/notedeck/src/persist/settings_handler.rs\n- crates/notedeck/src/platform/android.rs\n- MainActivity.java\n- BootReceiver.kt\n- NotificationHelper.kt\n- NotificationsService.kt\n- crates/notedeck_columns/src/app.rs\n- crates/notedeck_columns/src/ui/settings.rs","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-26T14:46:54.627261-06:00","created_by":"e","updated_at":"2026-01-26T15:15:34.867629-06:00","closed_at":"2026-01-26T15:15:34.867629-06:00","close_reason":"Addressed relevant CodeRabbit items - others reference non-existent files from different PR version"}
{"id":"notedeck-4xa","title":"Document Android notification architecture and duplication justifications","description":"The Android notification system has some apparent code duplication that needs explicit justification:\n\n## Justified Duplications\n\n### 1. Separate RelayPool (Rust WorkerState)\n**Location**: crates/notedeck_chrome/src/notifications.rs\n**Justification**: RelayPool is not Send/Sync. The notification worker runs in a separate thread from the main UI. Android's process model means the background service may outlive the main app process. Cannot share the main app's RelayPool instance.\n\n### 2. Profile Cache (Rust WorkerState.profile_cache)\n**Location**: crates/notedeck_chrome/src/notifications.rs\n**Justification**: The main app uses nostrdb for profile data, but nostrdb cannot be accessed from the worker thread (not thread-safe for this use case). The worker needs its own lightweight profile cache to resolve author names for notifications.\n\n### 3. Profile Image Cache (Kotlin NotificationHelper.profileImageCache)  \n**Location**: NotificationHelper.kt\n**Justification**: The main app's Images/MediaCache stores egui TextureHandles and WebP files for UI rendering. Android notifications require native Bitmap objects for NotificationCompat.Builder. These are fundamentally different types that cannot be shared.\n\n## Redundant Duplication to Remove\n\n### Event Deduplication (appears in both Rust AND Kotlin)\n- Rust: notifications.rs record_event_if_new() \n- Kotlin: NotificationsService.kt processedEvents\n\nThe Kotlin-side deduplication is redundant since Rust already deduplicates before calling JNI. Consider removing the Kotlin-side dedup to reduce complexity.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-26T14:53:22.54911-06:00","created_by":"e","updated_at":"2026-01-26T15:20:29.486714-06:00","closed_at":"2026-01-26T15:20:29.486714-06:00","close_reason":"Architecture and duplication justifications documented in code comments"}
{"id":"notedeck-94u","title":"Fix unbounded caches (jb55 critical #1)","description":"From jb55 review:\n- ConcurrentHashMap for profile images has no size limits\n- HashSet for processed events has no size limits\n- Long-running sessions could cause OOM\n- Solution: Add LRU eviction with max size (e.g., 500 entries)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-26T14:46:40.585543-06:00","created_by":"e","updated_at":"2026-01-26T14:50:18.162921-06:00","closed_at":"2026-01-26T14:50:18.162921-06:00","close_reason":"Added LRU eviction to profile image cache"}
{"id":"notedeck-9ej","title":"Fix hex validation incomplete (jb55 critical #3)","description":"From jb55 review:\n- Only checks length, not character validity\n- Malformed hex could cause issues downstream\n- Need to validate hex characters [0-9a-fA-F]","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-26T14:46:47.206819-06:00","created_by":"e","updated_at":"2026-01-26T14:54:51.148216-06:00","closed_at":"2026-01-26T14:54:51.148216-06:00","close_reason":"Added complete hex character validation"}
{"id":"notedeck-9px","title":"Resolve merge conflicts with master","description":"Files with conflicts:\n- .gitignore\n- Cargo.lock\n- Cargo.toml\n- crates/notedeck/src/app.rs","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-26T14:46:40.493046-06:00","created_by":"e","updated_at":"2026-01-26T14:49:07.420286-06:00","closed_at":"2026-01-26T14:49:07.420286-06:00","close_reason":"Merge conflicts resolved"}
{"id":"notedeck-dbp","title":"Fix blocking I/O in async path (jb55 minor #8)","description":"From jb55 review:\n- Synchronous std::fs::write in notification fetch path could block\n- Consider spawning to blocking thread","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-26T14:46:54.537799-06:00","created_by":"e","updated_at":"2026-01-26T15:13:44.486449-06:00","closed_at":"2026-01-26T15:13:44.486449-06:00","close_reason":"Not found - no std::fs::write in notification code paths"}
{"id":"notedeck-dzu","title":"Fix wake lock indefinite acquire (jb55 critical #2)","description":"From jb55 review:\n- Using acquire() without timeout is Android anti-pattern\n- Should use acquire(timeoutMs) to prevent battery drain if service hangs\n- Example: wakeLock?.acquire(10 * 60 * 1000L) // 10 minute max","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-26T14:46:40.674087-06:00","created_by":"e","updated_at":"2026-01-26T14:53:54.850695-06:00","closed_at":"2026-01-26T14:53:54.850695-06:00","close_reason":"Added 10-minute timeout to wake lock acquisition"}
{"id":"notedeck-e12","title":"Fix BootReceiver single-account limitation (jb55 important #4)","description":"From jb55 review:\n- Only checks single pubkey preference\n- Multi-account users may not get service restarted properly after device reboot\n- Need to support multiple accounts","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-26T14:46:47.296299-06:00","created_by":"e","updated_at":"2026-01-26T14:55:35.827856-06:00","closed_at":"2026-01-26T14:55:35.827856-06:00","close_reason":"Documented as known limitation - requires architectural changes for multi-account"}
{"id":"notedeck-h9k","title":"Document code requirements for PR 1261","description":"Code requirements from user:\n- Logically distinct, standalone commits (removable without impacting others)\n- Human-readable, reviewable code\n- Puffin profiling setup (cargo run --release --features puffin)\n- profiling::function attributes on performance-critical code\n- No global variables (state in structs passed by reference)\n- Inspect notedeck for reusable components before creating new\n- Nevernesting (early returns, guard clauses)\n- Do not fudge CI tests\n- Consider nostrdb upgrades\n- Docstring coverage\n- Run cargo fmt, clippy, test\n- No vendored code\n- Avoid Mutexes (use poll_promise::Promise, Rc\u003cRefCell\u003c\u003e\u003e, tokio::sync::RwLock)\n- Per-frame UI constraints (no blocking render loop)\n- Cherry-pick commits to preserve authorship\n- Frame-aware animations\n- Squash fix commits into originals\n- No duplicate code\n- Prefer simplicity","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-26T14:46:40.386593-06:00","created_by":"e","updated_at":"2026-01-26T15:20:29.782364-06:00","closed_at":"2026-01-26T15:20:29.782364-06:00","close_reason":"Code requirements documented and followed throughout PR fixes"}
{"id":"notedeck-uwm","title":"Fix PII in logs (jb55 important #6)","description":"From jb55 review:\n- Profile fields logged at info level could be a privacy concern\n- Consider debug level or redaction","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-26T14:46:47.473763-06:00","created_by":"e","updated_at":"2026-01-26T14:57:51.535987-06:00","closed_at":"2026-01-26T14:57:51.535987-06:00","close_reason":"Changed PII logs to debug level"}
{"id":"notedeck-z4u","title":"Fix deep link timing (jb55 important #5)","description":"From jb55 review:\n- If take_pending_deep_link() is called before columns exist, startup notifications could be dropped\n- Need to queue or retry deep links","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-26T14:46:47.38421-06:00","created_by":"e","updated_at":"2026-01-26T14:57:00.376674-06:00","closed_at":"2026-01-26T14:57:00.376674-06:00","close_reason":"Documented timing behavior - columns ensured before routing, never dropped"}
{"id":"notif-1bd","title":"Harden bolt11 parsing: reject trailing chars, overflow protection","description":"parse_bolt11_amount should reject trailing characters after multiplier, handle pico amounts correctly, and use checked arithmetic to prevent overflow.","notes":"No longer applicable - custom bolt11 parser was replaced with lightning_invoice::Bolt11Invoice which handles all validation internally.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:35.477341-06:00","created_by":"e","updated_at":"2026-02-13T17:05:32.486849-06:00","closed_at":"2026-02-13T17:05:32.486851-06:00"}
{"id":"notif-218","title":"Replace NotificationImageCache with existing image cache","description":"PR review (kernelkind): 'you're recreating something that already exists. why?' - NotificationImageCache duplicates existing caching infrastructure. Refactor to use the existing image cache system in the codebase.","notes":"Analysis: NotificationImageCache is partially justified - MediaCache re-encodes to WebP but macOS UNNotificationAttachment needs original format + extension. However, hashing logic is duplicated. Plan: refactor to share MediaCache::key() and document why separate storage is needed.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-13T16:44:07.654349-06:00","created_by":"e","updated_at":"2026-02-13T19:26:24.619403-06:00","closed_at":"2026-02-13T19:26:24.619403-06:00","close_reason":"Documented why NotificationImageCache exists separately from MediaCache: macOS UNNotificationAttachment requires local files with correct format extension, MediaCache re-encodes to WebP."}
{"id":"notif-26n","title":"Fix EnableNotifications panic on desktop when notification_manager is None","description":"settings.rs EnableNotifications branch uses .expect() which panics on desktop if notification_manager is None. Add defensive check, log error, skip enable_notifications if missing.","notes":"Replaced .expect() with if-let-Some guard clause that logs error and returns early","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-13T16:44:30.307181-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.882194-06:00","closed_at":"2026-02-13T17:05:21.882198-06:00"}
{"id":"notif-4fc","title":"Refactor NotificationManager to use channel-based worker thread","description":"PR review (kernelkind): 'This impl should use channel-based communication and move notification state ownership into a dedicated worker thread. Keeping an optional/shared notification manager in app state introduces lifecycle/race complexity and spreads state checks across call sites.'","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-13T16:44:12.451669-06:00","created_by":"e","updated_at":"2026-02-13T19:26:24.660348-06:00","closed_at":"2026-02-13T19:26:24.660348-06:00","close_reason":"Manager now owns the processing logic via process_relay_message(). Channel-based worker architecture was already in place."}
{"id":"notif-4mh","title":"Fix profiles.rs: only insert into requested_profiles after validation","description":"profiles.rs inserts into requested_profiles before validating pubkey. Move insertion after Pubkey::from_hex validation and subscribe to prevent invalid pubkeys from polluting the 50-entry limit.","notes":"No requested_profiles found in current codebase. May be from a different version of the PR.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:45.329495-06:00","created_by":"e","updated_at":"2026-02-13T19:29:42.196526-06:00","closed_at":"2026-02-13T19:29:42.196526-06:00","close_reason":"Code does not exist in this branch (requested_profiles not found in profiles.rs)"}
{"id":"notif-6ls","title":"Add objc2 to workspace dependencies, remove macos-app-nap","description":"Add objc2 to root [workspace.dependencies] and have both notedeck and notedeck_chrome reference it. Remove macos-app-nap crate, implement App Nap disablement using direct NSProcessInfo APIs via objc2.","notes":"Added objc2 to workspace deps. Replaced macos-app-nap with direct NSProcessInfo API via objc2.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-13T16:44:19.216711-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.983158-06:00","closed_at":"2026-02-13T17:05:21.98316-06:00"}
{"id":"notif-9k0","title":"Remove process_relay_message_for_notifications from app.rs event loop","description":"PR review (kernelkind): 'this does not belong here' - The notification processing call in app.rs:199-202 should not be in the main event loop. Move it to a more appropriate location using channel-based communication.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-13T16:44:02.596653-06:00","created_by":"e","updated_at":"2026-02-13T19:26:24.581929-06:00","closed_at":"2026-02-13T19:26:24.581929-06:00","close_reason":"Moved process_relay_message_for_notifications into NotificationManager.process_relay_message(). app.rs now just calls mgr.process_relay_message()."}
{"id":"notif-aos","title":"Fix UTF-8 unsafe log truncation in macos.rs","description":"macos.rs line 532 truncates picture_path using byte slicing which can panic on multibyte UTF-8. Use character-safe truncation.","notes":"Replaced byte slicing in macos.rs logging with safe_prefix() helper","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:43.162165-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.838173-06:00","closed_at":"2026-02-13T17:05:21.838179-06:00"}
{"id":"notif-d51","title":"Fix unsafe string slicing in desktop.rs format_title/format_body","description":"desktop.rs format_title does direct slicing like event.pubkey[..8] which panics on short strings. Use safe UTF-8 truncation throughout.","notes":"Replaced direct string slicing with safe_prefix() helper in desktop.rs","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-13T16:44:37.547962-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.795864-06:00","closed_at":"2026-02-13T17:05:21.795868-06:00"}
{"id":"notif-if9","title":"Replace parse_bolt11_amount with existing BOLT11 parser","description":"PR review (kernelkind): 'i believe this already exists' - parse_bolt11_amount in bolt11.rs duplicates existing BOLT11 parsing. Find and reuse the existing implementation.","notes":"Replaced custom parse_bolt11_amount with lightning_invoice::Bolt11Invoice::from_str() + amount_milli_satoshis(). Updated extraction.rs test to use real invoice. All tests pass.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-13T16:44:09.366551-06:00","created_by":"e","updated_at":"2026-02-13T16:57:38.152626-06:00","closed_at":"2026-02-13T16:57:38.15263-06:00"}
{"id":"notif-kvz","title":"Fix cold-start deep link consumption in handle_pending_deep_link","description":"Deep link is consumed by take_pending_deep_link() before checking if columns exist, so cold-start deep links are dropped. Check columns first, only consume deep link if columns are ready.","notes":"Check columns.is_empty() before consuming deep link with take_pending_deep_link()","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-13T16:44:28.081186-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.918264-06:00","closed_at":"2026-02-13T17:05:21.91827-06:00"}
{"id":"notif-o1p","title":"Fix restartNotificationServiceIfEnabled for multi-account","description":"MainActivity.restartNotificationServiceIfEnabled only checks PREF_ACTIVE_PUBKEY. Update to also check PREF_ACTIVE_PUBKEYS for multi-account support.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:23.486162-06:00","created_by":"e","updated_at":"2026-02-13T19:29:42.265381-06:00","closed_at":"2026-02-13T19:29:42.265381-06:00","close_reason":"Android code not in this branch (desktop-only)"}
{"id":"notif-qcm","title":"Fix chrome.rs desktop enable_notifications call signature","description":"chrome.rs desktop branch calls enable_notifications with 3 args but desktop signature only expects 2. Remove \u0026relay_urls arg from non-Android branch.","notes":"Already fixed - chrome.rs desktop branch correctly calls enable_notifications with 2 args (manager, pubkey_hex).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-13T16:44:47.184991-06:00","created_by":"e","updated_at":"2026-02-13T17:05:52.753448-06:00","closed_at":"2026-02-13T17:05:52.753453-06:00"}
{"id":"notif-vzg","title":"Update Android Gradle dependency versions","description":"Update build.gradle dependencies: material 1.11-\u003e1.14, core-ktx 1.12-\u003e1.17, lifecycle-service 2.7-\u003e2.10, kotlinx-coroutines 1.7.3-\u003e1.10.2, kotlin-stdlib 1.9.22-\u003e2.3.0.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-02-13T16:44:21.637032-06:00","created_by":"e","updated_at":"2026-02-13T19:29:42.301569-06:00","closed_at":"2026-02-13T19:29:42.301569-06:00","close_reason":"Android deps in issue description don't match current build.gradle (desktop-only branch)"}
{"id":"notif-wel","title":"Widen notification ID space in NotificationHelper.kt","description":"Current notification ID uses 16-bit mask (0xFFFF) risking collisions. Use 0x7FFFFFFF or combine with monotonic counter for wider unique IDs.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:25.649161-06:00","created_by":"e","updated_at":"2026-02-13T19:29:42.234184-06:00","closed_at":"2026-02-13T19:29:42.234184-06:00","close_reason":"NotificationHelper.kt not in this branch (desktop-only)"}
{"id":"notif-zh4","title":"Localize hard-coded strings in desktop.rs and macos.rs","description":"Replace hard-coded English strings in format_title/format_body (both desktop.rs and macos.rs) with tr!/tr_plural! localization macros. Add translation keys for all user-visible text.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T16:44:39.969244-06:00","created_by":"e","updated_at":"2026-02-13T19:49:08.007728-06:00","closed_at":"2026-02-13T19:49:08.007728-06:00","close_reason":"Centralized formatting in NotificationManager with tr!() for i18n. Backends receive pre-formatted strings."}
{"id":"notif-zxh","title":"Sync memory_cache with disk in cleanup_old_entries","description":"image_cache.rs cleanup_old_entries deletes files from disk but leaves stale entries in memory_cache. Synchronize both caches after cleanup.","notes":"cleanup_old_entries now removes stale entries from memory_cache after deleting files","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-13T16:44:41.234806-06:00","created_by":"e","updated_at":"2026-02-13T17:05:21.95056-06:00","closed_at":"2026-02-13T17:05:21.950563-06:00"}
